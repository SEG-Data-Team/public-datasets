<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
<head>
    <style>
        /* style placeholder */
/* Styling for the popup */
.popup {
    display: none;
    max-width: 500px;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 30px;
    background-color: white;
    border: 1px solid #ccc;
    box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.3);
    z-index: 1000;
}

.close-button {
    position: absolute;
    top: 10px;
    right: 10px;
    background-color: transparent;
    border: none;
    cursor: pointer;
}

.overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 900;
}

.button-container {
    display: flex; /* Use flex display to make the buttons sit next to each other */
    justify-content: space-between; /* Space them evenly within the container */
}


/* Styles for the container and checkboxes */
/*.multiselect-container {
    display: inline-block;
    padding: 1px;
    border-radius: 1px;
}

.multiselect-container label {
    display: block;
    margin-bottom: 5px;
}*/

/* Styles for the tags container and individual tags */
.tags-container {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 5px;
    padding: 5px;
    border-radius: 5px;
}
 .tag {
    background-color: #f1f1f1;
    padding: 5px 10px;
    border-radius: 5px;
    display: flex;
    align-items: center;
}

.tag span {
    margin-right: 5px;
}

.tag .remove-tag {
    cursor: pointer;
    font-weight: light;
    color: black;
}


/* Styles for financial metrics */
.custom-form {
    max-width: 300px;
    background-color: #fff;
    border-radius: 5px;
    padding-bottom: 10px;
    margin: 0 auto;
    margin-bottom: 20px;
    margin-left: 0; /* Adjust the margin-left value as needed */
}

.popup-form {
    background-color: #fff;
    border-radius: 5px;
    padding-bottom: 10px;
    margin: 0 auto;
    margin-bottom: 20px;
    padding: 10px;
    margin-left: 0; /* Adjust the margin-left value as needed */
}


.input-container {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 5px;
}

label {
    display: block;
    margin-bottom: 5px;
}

input[type="number"],
input[type="checkbox"] {
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

input[type="text"],
input[type="email"],
input[type="password"] {
    padding: 5px;
    margin-bottom: 5px;
    margin-top: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
}

select {
    width: 25%;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    font-size: 16px;
}

option {
    font-size: 12px;
}

/* Styling the arrow icon (optional) */
select::-ms-expand {
    display: none;
}

select::after {
    content: "â–¼";
    font-size: 12px;
    padding-left: 5px;
}

/* Styles for the search bar and dropdown */
.search-container {
    position: relative;
    display: inline-block;
}

.search-input {
    width: 200px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 5px;
}

.search-list {
    position: relative;
    top: 100%;
    left: 0;
    width: 100%;
    background-color: #fff;
    border: 1px solid #ccc;
    border-top: none;
    display: none;
    max-height: 150px;
    overflow-y: auto; /* Added scrollable behavior */
    border-radius: 0 0 5px 5px;
}

.search-list div {
    padding: 5px;
    cursor: pointer;
}

.multiselect-container {
    display: inline-block;
    padding: 5px;
    border-radius: 5px;
}

.multiselect-container label {
    display: block;
    margin-bottom: 5px;
}   

.link-style {
    color: #2e95de; /* Apply the desired hyperlink color */
    cursor: pointer; /* Change the cursor to a pointer on hover */
}

/*loader styling*/
.loader {
    border: 16px solid #f3f3f3; /* Light grey */
    border-top: 16px solid #2e95de; /* Blue */
    border-radius: 50%;
    width: 100px;
    height: 100px;
    animation: spin 2s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/*user info styling*/
.sticky {
    position: fixed;
    right: 10px;
    top: 100px;
    background: white;
    text-align:right
}

.tinyButton {
    background-color:#2e95de;
    border-radius: 16px;
    border:none;
    text-align:center;
    font-size:14px;
    color:#ffffff;
    padding:5px;
    margin:6px 0px;
}

/*financials labels*/
.fromToLabel {
    display: inline-block;
}

.fromToLabelNulls {
    display: block;
    white-space: nowrap;
}

/*user warning*/
.userWarning {
    display: none;
    color: red;
}
    </style>
</head>

<body>
<div id="pageContent" style="display: flex; justify-content: center; align-items: center;">
    <div id="loginPlaceholder" style="max-width: 600px;"></div>
    <br>
    <div id="spinPlaceholder" style="display: block;">
        <div class="loader" ></div>
    </div>
</div>
<div id="accountInfo" style="display: none;">
<p id="greeting">Hello, <span id="userName"></span></p>
<p>Email: <span id="userEmail"></span></p>
<button id="deleteAccountButton" class="sqs-button-element--primary">Delete My Account</button>
</div>

<!-- JavaScript code -->
<script>
    /* script placeholder*/
var defaultResponses = {
    200: "OK",
    400: "Your request is in an invalid format. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    401: "You are unauthorized to perform this action. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    403: "Your account appears to have been blocked/frozen. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    405: "Method not allowed. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    409: "There is already a user account associated with this email address.",
    415: "Unsupported media type. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    420: "This email has not yet been verified.",
    422: "Your password does not meet the minimum required standards. Please try again.",
    423: "This account has been deleted in the last 7 days and is not yet available.",
    427: "Unfortunately, we were unable to process your provided input. We are working to improve our model and hope to serve you better in the future.",
    429: "You have made too many requests in a short amount of time. Please wait 10 seconds between requests. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    430: "Unfortunately, our servers are currently overloaded. Please retry your request tomorrow or reach out to hello@stubbenedgelabs.com.",
    500: "We have encountered an unexpected error. Please reach out to hello@stubbenedgelabs.com if the error persists.",
    900: "Log in error. Please ensure cross-site tracking is enabled in browser settings",
    999: "We have encountered an unexpected error. Please reach out to hello@stubbenedgelabs.com if the error persists."
}
const Md5 = function (d) {
    // https://stackoverflow.com/questions/14733374/how-to-generate-an-md5-file-hash-in-javascript-node-js
    var r = M(V(Z(X(d), 8 * d.length))); return r.toLowerCase()
};
function M(d) { for (var _, m = "0123456789ABCDEF", f = "", r = 0; r < d.length; r++)_ = d.charCodeAt(r), f += m.charAt(_ >>> 4 & 15) + m.charAt(15 & _); return f } 
function X(d) { for (var _ = Array(d.length >> 2), m = 0; m < _.length; m++)_[m] = 0; for (m = 0; m < 8 * d.length; m += 8)_[m >> 5] |= (255 & d.charCodeAt(m / 8)) << m % 32; return _ } 
function V(d) { for (var _ = "", m = 0; m < 32 * d.length; m += 8)_ += String.fromCharCode(d[m >> 5] >>> m % 32 & 255); return _ } 
function Z(d, _) { 
    d[_ >> 5] |= 128 << _ % 32, d[14 + (_ + 64 >>> 9 << 4)] = _; for (var m = 1732584193, f = -271733879, r = -1732584194, i = 271733878, n = 0; n < d.length; n += 16) { var h = m, t = f, g = r, e = i; f = md5_ii(f = md5_ii(f = md5_ii(f = md5_ii(f = md5_hh(f = md5_hh(f = md5_hh(f = md5_hh(f = md5_gg(f = md5_gg(f = md5_gg(f = md5_gg(f = md5_ff(f = md5_ff(f = md5_ff(f = md5_ff(f, r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 0], 7, -680876936), f, r, d[n + 1], 12, -389564586), m, f, d[n + 2], 17, 606105819), i, m, d[n + 3], 22, -1044525330), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 4], 7, -176418897), f, r, d[n + 5], 12, 1200080426), m, f, d[n + 6], 17, -1473231341), i, m, d[n + 7], 22, -45705983), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 8], 7, 1770035416), f, r, d[n + 9], 12, -1958414417), m, f, d[n + 10], 17, -42063), i, m, d[n + 11], 22, -1990404162), r = md5_ff(r, i = md5_ff(i, m = md5_ff(m, f, r, i, d[n + 12], 7, 1804603682), f, r, d[n + 13], 12, -40341101), m, f, d[n + 14], 17, -1502002290), i, m, d[n + 15], 22, 1236535329), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 1], 5, -165796510), f, r, d[n + 6], 9, -1069501632), m, f, d[n + 11], 14, 643717713), i, m, d[n + 0], 20, -373897302), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 5], 5, -701558691), f, r, d[n + 10], 9, 38016083), m, f, d[n + 15], 14, -660478335), i, m, d[n + 4], 20, -405537848), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 9], 5, 568446438), f, r, d[n + 14], 9, -1019803690), m, f, d[n + 3], 14, -187363961), i, m, d[n + 8], 20, 1163531501), r = md5_gg(r, i = md5_gg(i, m = md5_gg(m, f, r, i, d[n + 13], 5, -1444681467), f, r, d[n + 2], 9, -51403784), m, f, d[n + 7], 14, 1735328473), i, m, d[n + 12], 20, -1926607734), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 5], 4, -378558), f, r, d[n + 8], 11, -2022574463), m, f, d[n + 11], 16, 1839030562), i, m, d[n + 14], 23, -35309556), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 1], 4, -1530992060), f, r, d[n + 4], 11, 1272893353), m, f, d[n + 7], 16, -155497632), i, m, d[n + 10], 23, -1094730640), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 13], 4, 681279174), f, r, d[n + 0], 11, -358537222), m, f, d[n + 3], 16, -722521979), i, m, d[n + 6], 23, 76029189), r = md5_hh(r, i = md5_hh(i, m = md5_hh(m, f, r, i, d[n + 9], 4, -640364487), f, r, d[n + 12], 11, -421815835), m, f, d[n + 15], 16, 530742520), i, m, d[n + 2], 23, -995338651), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 0], 6, -198630844), f, r, d[n + 7], 10, 1126891415), m, f, d[n + 14], 15, -1416354905), i, m, d[n + 5], 21, -57434055), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 12], 6, 1700485571), f, r, d[n + 3], 10, -1894986606), m, f, d[n + 10], 15, -1051523), i, m, d[n + 1], 21, -2054922799), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 8], 6, 1873313359), f, r, d[n + 15], 10, -30611744), m, f, d[n + 6], 15, -1560198380), i, m, d[n + 13], 21, 1309151649), r = md5_ii(r, i = md5_ii(i, m = md5_ii(m, f, r, i, d[n + 4], 6, -145523070), f, r, d[n + 11], 10, -1120210379), m, f, d[n + 2], 15, 718787259), i, m, d[n + 9], 21, -343485551), m = safe_add(m, h), f = safe_add(f, t), r = safe_add(r, g), i = safe_add(i, e) } return Array(m, f, r, i) } function md5_cmn(d, _, m, f, r, i) { return safe_add(bit_rol(safe_add(safe_add(_, d), safe_add(f, i)), r), m) } function md5_ff(d, _, m, f, r, i, n) { return md5_cmn(_ & m | ~_ & f, d, _, r, i, n) } function md5_gg(d, _, m, f, r, i, n) { return md5_cmn(_ & f | m & ~f, d, _, r, i, n) } function md5_hh(d, _, m, f, r, i, n) { return md5_cmn(_ ^ m ^ f, d, _, r, i, n) } function md5_ii(d, _, m, f, r, i, n) { return md5_cmn(m ^ (_ | ~f), d, _, r, i, n) } function safe_add(d, _) { var m = (65535 & d) + (65535 & _); return (d >> 16) + (_ >> 16) + (m >> 16) << 16 | 65535 & m } function bit_rol(d, _) {
    return d << _ | d >>> 32 - _
}

const getCanvasFingerprint = function () {
    // https://github.com/artem0/canvas-fingerprinting/blob/master/fingerprinting/fingerprint.js
    // https://www.browserleaks.com/canvas#how-does-it-work
    var canvas = document.createElement('canvas');
    var ctx = canvas.getContext('2d');
    var txt = 'CANVAS_FINGERPRINT';
    ctx.textBaseline = "top";
    ctx.font = "14px 'Arial'";
    ctx.textBaseline = "alphabetic";
    ctx.fillStyle = "#f60";
    ctx.fillRect(125, 1, 62, 20);
    ctx.fillStyle = "#069";
    ctx.fillText(txt, 2, 15);
    ctx.fillStyle = "rgba(102, 204, 0, 0.7)";
    ctx.fillText(txt, 4, 17);
    return canvas.toDataURL();
};

const generateFingerprint = function () {
    const userAgent = String(navigator.userAgent);
    const language = String(navigator.language);
    const languages = String(navigator.languages);
    const hardWareConcurrency = String(navigator.hardwareConcurrency);
    const deviceMemory = String(navigator.deviceMemory);
    const maxTouchPoints = String(navigator.maxTouchPoints);
    const oscpu = String(navigator.oscpu);
    const platform = String(navigator.platform);
    const vendor = String(navigator.vendor);
    const screenHeight = String(screen.height);
    const screenWidth = String(screen.width);
    const timeZone = String(Intl.DateTimeFormat().resolvedOptions().timeZone);
    const screenColorDepth = String(screen.colorDepth);
    const cpuClass = String(navigator.cpuClass);
    const canvasFingerprint = String(getCanvasFingerprint());
    const combinedElements = userAgent + language + languages + hardWareConcurrency + deviceMemory + maxTouchPoints + oscpu + platform + vendor + screenHeight + screenWidth + timeZone + screenColorDepth + cpuClass + canvasFingerprint;
    const md5Hash = Md5(combinedElements);
    const finalFingerprint = md5Hash.slice(0, 3) + "j" + md5Hash.slice(3, 5) + "o" + md5Hash.slice(5, 9) + "e" + md5Hash.slice(9, 14) + "i" + md5Hash.slice(14, 16) + "s" + md5Hash.slice(16, 17) + "k" + md5Hash.slice(17, 21) + "i" + md5Hash.slice(21, 24) + "n" + md5Hash.slice(24, 28) + "g" + md5Hash.slice(28);

    return finalFingerprint
}

const deviceFingerPrint = generateFingerprint()
async function isUserLoggedIn() {
    return new Promise(function(resolve, reject) {
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function(e) {
            if (xhr.readyState === 4) {
                if (xhr.status == 200) {
                    const response = JSON.parse(xhr.responseText);
                    resolve(response)
                } else {
                    resolve(false)
                }
            }
        }
        xhr.withCredentials = true;
        xhr.open('GET', 'https://prospect-gateway-a9jtfdvq.nw.gateway.dev/h00z_l0663d_1nn');
        xhr.setRequestHeader('X-Prospekt', deviceFingerPrint);
        xhr.send();
    })
}
function setDetails (name){
    var expire = new Date();
    expire.setMinutes(expire.getMinutes() + 20); // timestamp
    expire = new Date(expire); // Date object
    
    var prospektSessionObject = {
        expiresAt: expire,
        sessionData: {
            userName: name
        }
    }
    sessionStorage.setItem('prospektSessionObject', JSON.stringify(prospektSessionObject));
}

function updateDetails() {
    var prospektSessionObjectOld = JSON.parse(sessionStorage.getItem('prospektSessionObject'));
    var name = prospektSessionObjectOld.sessionData.userName
    var expire = new Date();
    expire.setMinutes(expire.getMinutes() + 20); // timestamp
    expire = new Date(expire); // Date object
    
    var prospektSessionObject = {
        expiresAt: expire,
        sessionData: {
            userName: name
        }
    }
    sessionStorage.setItem('prospektSessionObject', JSON.stringify(prospektSessionObject));
}

async function checkDetails (){
    var currentDate = new Date();
    var prospektSessionObject = JSON.parse(sessionStorage.getItem('prospektSessionObject'));
    if (prospektSessionObject == null) {
        console.log('no session');
        await setHeaderElementLogin(0);
    } else {
        console.log('session found');
        var expirationDate = prospektSessionObject.expiresAt;
        if (prospektSessionObject.sessionData.userName == 'Anonymous') {
            //pass
            console.log('session anon')
        }
        else if(Date.parse(currentDate) < Date.parse(expirationDate)) {
            //Session is still valid
            console.log('session valid')
            await setHeaderElementLogin(1);
        } else {
            //Session no longer valid
            sessionStorage.removeItem('prospektSessionObject');
            console.log('session expired');
            await setHeaderElementLogin(0);
        }
    }
};

async function removeDetails (){
    var prospektSessionObject = JSON.parse(sessionStorage.getItem('prospektSessionObject'));
    if (prospektSessionObject != null) {
        sessionStorage.removeItem('prospektSessionObject');
    }
};
async function setHeaderElementLogin(src) {
    //src = 0 - called by generic website pages - given no saved session data
    //src = 1 - called by generic website pages - given valid session data
    //src = 2 - called by the Login pop-up on the Prospekt page
    //src = 3 - called by login page (default)
    //src = 4 - called by login page (confirmation)
    //src = 5 - called by logout page
    //src = 6 - called by manage account
    //src = 7 - called by sign-up page
    //src = 8 - called by reset password
    //src = 9 - called by the Login pop-up on the BankerBot page

    const divElement = document.createElement('div');
    divElement.classList.add('header-actions-action', 'header-actions-action--cta', 'preFade', 'fadeIn');
    divElement.setAttribute('data-animation-role', 'header-element');
    divElement.style.transitionTimingFunction = 'ease';
    divElement.style.transitionDuration = '1.5s';
    divElement.style.transitionDelay = '0.13125s';

    const buttonElement = document.createElement('a');
    buttonElement.classList.add('btn', 'btn--border', 'theme-btn--primary-inverse', 'sqs-button-element--primary');
    buttonElement.id = "headerLoginButton"
    buttonElement.type = 'button'; 
    buttonElement.href = ''

    const nameElement = document.createElement('span');
    nameElement.style = "padding-right: 5px;"

    if (src == 2) {
        var overlay = document.getElementById('overlay');      
        var popup = document.getElementById('popup');
        var popupContent = document.getElementById('popupContent');
        var closeButton = document.createElement('button');
        closeButton.id = 'closeButton';
        closeButton.className = 'close-button';
        closeButton.textContent = 'x';
        closeButton.addEventListener('click', closePopup);
    }

    //get user name
    if (src == 1) {
        var prospektSessionObject = JSON.parse(sessionStorage.getItem('prospektSessionObject'));
        var userLoginStatus = {
            user_name: prospektSessionObject.sessionData.userName
        }
    } else {
        var userLoginStatus = await isUserLoggedIn()
    }

    //actions
    result = true
    if (userLoginStatus != false) {
        buttonElement.textContent = 'Log out';
        buttonElement.href = '/logout-page'
        nameElement.textContent = "Hello, " + userLoginStatus.user_name + '       '
        if (src != 1) {
            setDetails(userLoginStatus.user_name);
        }
        if (src == 2) {
            submitForm();
        }
        else if (src == 3 || src == 4) {
            populateWelcomePage();
        }
        else if (src == 5) {
            logOutUser();
            removeDetails();
        }
        else if (src == 6) {
            populateAccountPage(userLoginStatus);
        }
        else if (src == 7) {
            redirectManageAccount();
        }
        else if (src == 8) {
            populateForgotPasswordPage(userLoginStatus);
        }
        else if (src == 9) {
            uploadPDF(routeValidation);
        }
    } else {
        buttonElement.textContent = 'Log in';
        buttonElement.href = '/login-user'
        nameElement.textContent = ''
        setDetails('Anonymous')
        if (src == 2) {
            overlay.style.display = 'block';
            popup.style.display = 'block';
            popupContent.appendChild(closeButton);
            popupContent.innerHTML = 'Log in error. Please ensure cross-site tracking is enabled in browser settings'; 
        }
        else if (src == 3) {
            populateLoginPage();
        }
        else if (src == 4) {
            result = false
        }
        else if (src == 5) {
            populateGoodbyePage();
        }
        else if (src == 6) {
            redirectLoginPage();
        }
        else if (src == 7) {
            populateSignupPage();
        }
        else if (src == 8) {
            populateForgotPasswordPage(userLoginStatus);
        }
    }

    divElement.appendChild(nameElement);
    divElement.appendChild(buttonElement);
    const parentElement = document.querySelector('.header-actions--right');
    parentElement.innerHTML = ''
    parentElement.innerHTML += divElement.outerHTML;
    
    return result
}
function togglePasswordVisibility(inputField) {
    if (inputField.type === 'password') {
        inputField.type = 'text';
    } else {
        inputField.type = 'password';
    }
}

function validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

function validatePassword(password) {
    if (password.length < 8) {
        return false;
    }
    if (!/\d/.test(password)) {
        return false;
    }
    if (!/[a-z]/.test(password)) {
        return false;
    }
    if (!/[A-Z]/.test(password)) {
        return false;
    }
    if (!/[!@#$%^&*()_+{}\[\]:;<>,.?~\\/\-=|]/.test(password)) {
        return false;
    }
    return true;
}
//fingerprint

//isUserLoggedIn

//setDetails

//setHeaderUniversal
setHeaderElementLogin(3)

//validationFunctions

//defaultAPIResponses

//page specific
function populateWelcomePage() {
    const popupContainer = document.getElementById('loginPlaceholder')
    popupContainer.innerHTML = ''
    const spinContainer = document.getElementById('spinPlaceholder')
    spinContainer.style.display='none'
    
    const loginForm = document.createElement('form');
    loginForm.className = "popup-form"

    const header = document.createElement('h4')
    header.textContent = "Welcome back!"
    loginForm.appendChild(header)

    const manageAccountButton = document.createElement('button');
    manageAccountButton.type = "button"
    manageAccountButton.href = "/manage-account"
    manageAccountButton.className = "sqs-button-element--primary"
    manageAccountButton.width = '100%'
    manageAccountButton.style.display = 'block';
    manageAccountButton.style.margin = '5px';

    const manageRedirect = document.createElement('a');
    manageRedirect.textContent = "Manage your Account";
    manageRedirect.href = "/manage-account"
    manageRedirect.width = '100%'
    manageAccountButton.appendChild(manageRedirect)

    loginForm.append(manageAccountButton)
    loginForm.append(document.createElement('p'))

    const prospektButton = document.createElement('button');
    prospektButton.type = "button"
    prospektButton.className = "sqs-button-element--primary"
    prospektButton.width = '100%'
    prospektButton.style.display = 'block';
    prospektButton.style.margin = '5px';

    const prospektRedirect = document.createElement('a');
    prospektRedirect.textContent = "Get started with Prospekt";
    prospektRedirect.href = "/prospekt"
    prospektRedirect.width = '100%'
    prospektButton.appendChild(prospektRedirect)
    
    loginForm.append(prospektButton)
    loginForm.append(document.createElement('p'))

    const bankerbotButton = document.createElement('button');
    bankerbotButton.type = "button"
    bankerbotButton.className = "sqs-button-element--primary"
    bankerbotButton.width = '100%'
    bankerbotButton.style.display = 'block';
    bankerbotButton.style.margin = '5px';

    const bankerbotRedirect = document.createElement('a');
    bankerbotRedirect.textContent = "Get started with Bankerbot";
    bankerbotRedirect.href = "/bankerbot"
    bankerbotRedirect.width = '100%'
    bankerbotButton.appendChild(bankerbotRedirect)

    loginForm.append(bankerbotButton)
    loginForm.append(document.createElement('p'))

    popupContainer.appendChild(loginForm)
}

function loginUser(email, password) {
    const popupContent = document.getElementById('loginPlaceholder');
    const spinContent = document.getElementById('spinPlaceholder');
    const returnMessage = document.getElementById('returnMessage');
    
    var xhr = new XMLHttpRequest();
    xhr.withCredentials = true;
    xhr.onreadystatechange = async function () {
        if (xhr.readyState == 4) {
            if (xhr.status != 200) {
                spinContent.style.display = 'none'
                popupContent.style.display = 'block'
            }
            if (xhr.status == 200) {
                let loginTest = await setHeaderElementLogin(4);
                spinContent.style.display = 'none'
                popupContent.style.display = 'block'
                if(loginTest == false) {
                    returnMessage.innerHTML = defaultResponses[900];
                }
            } else if (xhr.status == 401) {
                returnMessage.innerHTML = 'This user and/or password combination does not exist.'; 
            } else if (xhr.status == 420) {
                returnMessage.innerHTML = defaultResponses[xhr.status]; 
                popupVerficationEmail(email.toLowerCase(),password)
            } else if (xhr.status in defaultResponses) {
                returnMessage.innerHTML = defaultResponses[xhr.status]; 
            } else {
                returnMessage.innerHTML = defaultResponses[999];
            }
        }
    }

    xhr.open("POST", "https://prospect-gateway-a9jtfdvq.nw.gateway.dev/l0g_yuz4_1n", false);
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.setRequestHeader('X-Prospekt', deviceFingerPrint);
    xhr.send(JSON.stringify({"email_address": email.toLowerCase(), "password": password }));  
}

function resendEmailVerification(email, password) {
    const popupContent = document.getElementById('loginPlaceholder');
    popupContent.innerHTML = '<div class="loader" ></div>' 

    var xhr = new XMLHttpRequest();
    xhr.withCredentials = true;
    xhr.onreadystatechange = function () {
        if (xhr.readyState == 4) {
            popupContent.innerHTML = '' // Clear any previous content
            if (xhr.status == 200) {
                popupContent.innerHTML = 'Verification link sent. Please check your email for further details.'; 
            } else if (xhr.status in defaultResponses) {
                popupContent.innerHTML = defaultResponses[xhr.status]; 
            } else {
                popupContent.innerHTML = defaultResponses[999];
            }
        } 
    }
    xhr.open("POST", "https://prospect-gateway-a9jtfdvq.nw.gateway.dev/r353nd_v3r1fy_3m41l_l1nc", false);
    xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhr.setRequestHeader('X-Prospekt', deviceFingerPrint);
    xhr.send(JSON.stringify({"email_address": email, "password": password}));    
}

function popupVerficationEmail(email, password) {
    const popupContent = document.getElementById('loginPlaceholder');

    popupContent.innerHTML = ''
    const header = document.createElement('h4');
    header.textContent = "Email Verification" 

    const headlineSummary = document.createElement('p');
    headlineSummary.textContent = "Resend email verifcation link?" 

    const noButton = document.createElement('button');
    noButton.id = 'emailVerfNoBtn';
    noButton.className = 'sqs-button-element--primary';
    noButton.style.display = 'block';
    noButton.style.width = '100%';
    noButton.style.margin = '10px';
    noButton.textContent = 'No';
    noButton.addEventListener('click', populateLoginPage);

    const yesButton = document.createElement('button');
    yesButton.id = 'emailVerfYesBtn';
    yesButton.className = 'sqs-button-element--primary';
    yesButton.style.display = 'block';
    yesButton.style.width = '100%';
    yesButton.style.margin = '10px';
    yesButton.textContent = 'Yes';
    yesButton.onclick = async function() {
        popupContent.innerHTML = '<div class="loader" ></div>' 
        await new Promise(r => setTimeout(r, 1000));
        resendEmailVerification(email,password)
    };

    const buttonContainer = document.createElement('div');
    buttonContainer.className = 'button-container'
    buttonContainer.appendChild(noButton);
    buttonContainer.appendChild(yesButton);

    popupContent.appendChild(header);
    popupContent.appendChild(headlineSummary);
    popupContent.appendChild(buttonContainer)
}

function populateLoginPage() {
    const popupContainer = document.getElementById('loginPlaceholder')
    popupContainer.innerHTML='';
    const spinContainer = document.getElementById('spinPlaceholder')
    spinContainer.style.display='none'
    
    const headlineSummary = document.createElement('h4');
    headlineSummary.textContent = "Login" 

    const subtitle = document.createElement('p');
    subtitle.innerHTML = 'Welcome back! Please sign in to continue.';

    const redirectSignup = document.createElement('p');
    redirectSignup.innerHTML = "Don't have an account? <a id='signupLink' href='/sign-up' class='link-style'>Sign up for free here</a>";

    const tsandcs = document.createElement('div');
    tsandcs.style.display = 'block';
    tsandcs.innerHTML = '<small>By signing in, you agree to our ' +
        '<a href="https://www.stubbenedge.com/terms-of-use/" target="_blank" class="link-style">Terms of Use</a>, our ' +
        '<a href="https://www.stubbenedge.com/privacy-policy/" target="_blank" class="link-style">Privacy Policy</a>, ' +
        'and our ' +
        '<a href="https://prospekt-docs.s3.eu-west-1.amazonaws.com/MARKET_DATA_SUPPLY_AGREEMENT_PROSPEKT.pdf" target="_blank" class="link-style">Market Data Supply Agreement.</a></small>';

     // User login form
    const loginForm = document.createElement('form');
    loginForm.className = "popup-form"

    const emailInput = document.createElement('input');
    emailInput.type = 'email';
    emailInput.style.width = '95%';
    emailInput.placeholder = 'Email';
    emailInput.required = true;

    const passwordInput = document.createElement('input');
    passwordInput.type = 'password';
    passwordInput.style.width = '95%';
    passwordInput.placeholder = 'Password';
    passwordInput.required = true;

    // Toggle button for showing/hiding password
    const togglePasswordButton1 = document.createElement('button');
    const eyeIcon1 = document.createElement('i');
    eyeIcon1.classList.add('fas', 'fa-eye'); // Font Awesome classes for the eye icon
    togglePasswordButton1.appendChild(eyeIcon1); // Add the icon to the button
    togglePasswordButton1.style = "margin-left: -40px; cursor: pointer; border: none; background-color: transparent;"
    togglePasswordButton1.className = 'password-toggle-button';
    togglePasswordButton1.type = 'button';
    togglePasswordButton1.addEventListener('click', function() {
        togglePasswordVisibility(passwordInput);
    });

    const passwordContainer = document.createElement('div');
    passwordContainer.style.width = '100%'
    passwordContainer.appendChild(passwordInput);
    passwordContainer.appendChild(togglePasswordButton1); // Add toggle button

    const loginButton = document.createElement('button');
    loginButton.type = 'button';
    loginButton.className = 'sqs-button-element--primary';
    loginButton.style.display = 'block';
    loginButton.style.width = '95%';
    loginButton.style.margin = '5px';
    loginButton.textContent = 'Login';

    const returnMessage = document.createElement('div')
    returnMessage.id = 'returnMessage'
    returnMessage.style.color = '#FF6961';

    loginButton.addEventListener('click', async function() {
        let email = emailInput.value;
        let password = passwordInput.value;

        // Check if the email, password, and confirm password are provided
        const isEmailValid = email != ''
        const isPasswordValid = password != ''

        if (isEmailValid && isPasswordValid) {
            popupContainer.style.display = 'none'
            spinContainer.style.display = 'block'
            await new Promise(r => setTimeout(r, 1000));
            loginUser(email, password);
        } else {
            returnMessage.innerHTML = "Please provide valid inputs"
        }
    });    

    loginForm.appendChild(emailInput);
    loginForm.appendChild(passwordContainer);
    loginForm.appendChild(returnMessage);
    loginForm.appendChild(loginButton);
    loginForm.appendChild(tsandcs);

    const forgotPassword = document.createElement('button');
    forgotPassword.className = 'sqs-button-element--secondary';
    forgotPassword.type = "button"
    forgotPassword.style.display = 'block';
    forgotPassword.style.width = '95%';
    forgotPassword.style.margin = '5px';
    
    const forgotPasswordRedirect = document.createElement('a');
    forgotPasswordRedirect.textContent = 'Forgot password';
    forgotPasswordRedirect.href = '/forgot-password'
    
    forgotPassword.appendChild(forgotPasswordRedirect);

    loginForm.appendChild(document.createElement('br'));
    loginForm.appendChild(forgotPassword);
    loginForm.appendChild(redirectSignup);
    popupContainer.appendChild(headlineSummary);
    popupContainer.appendChild(subtitle);
    popupContainer.appendChild(loginForm);
    //popupContainer.appendChild(forgotPassword);
    //popupContainer.appendChild(redirectSignup);
}
</script>
</body><p hidden id=version_date>Tue Nov 28 11:39:47 UTC 2023</p>
